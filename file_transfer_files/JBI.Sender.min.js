/**
 * JustBeamIt - v2.2.0 - 2018-11-05
 * http://www.justbeamit.com
 *
 * Copyright (c) 2018 - All Rights Reserved
 * Written by Hristo Oskov
 */
!function(a,b){b["true"]=a;var c=function(a,b,c,d){var e=function(){if(function(){for(var b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=a.console||{};d--;)e[c[d]]=e[c[d]]||b;a.console=e}(),!c.support.cors&&a.XDomainRequest){var b=/^\d+$/,e=/^https?:\/\//i,f=/^get|post$/i,g=new RegExp("^"+location.protocol,"i");c.ajaxTransport("text html xml json",function(a,h,i){if(a.crossDomain&&a.async&&f.test(a.type)&&e.test(h.url)&&g.test(h.url)){var j=null;return{send:function(e,f){function g(a,b,e,g){j.onload=j.onerror=j.ontimeout=c.noop,j=d,f(a,b,e,g)}j=new XDomainRequest,j.onload=function(){var a={text:j.responseText},b={code:200,message:"XDomainRequest success"},d="Content-Length: "+j.responseText.length+"\r\nContent-Type: "+j.contentType;try{var e=(h.dataType||"").toLowerCase();if("json"!==e)throw"non-JSON data type";try{a.json=c.parseJSON(j.responseText)}catch(f){b.code=500,b.message="JSON parse error - invalid xdr.responseText JSON"}}catch(f){throw console.log("----XDomainRequest onload: catch exception----"),console.log(f),console.log(pp(f)),console.log("----------------------------------------------"),f}finally{g(b.code,b.message,a,d)}},j.onprogress=function(){},b.test(h.timeout)&&(j.timeout=h.timeout),j.ontimeout=function(){g(500,"XDomainRequest timeout")},j.onerror=function(){g(500,"XDomainRequest error")},a.url+="?"+a.data,j.open(a.type,a.url),j.send(a.hasContent&&a.data||null)},abort:function(){j&&(j.onerror=c.noop(),j.abort())}}}})}return{initialize:function(a){console.log("---- JBI initialize ----"),object&&object.constructor&&object.call&&object.apply?a():console.log("'"+a+"' is not a function.")}}}();e.STATIC={},e.STATIC.CLIENT="WEB",e.STATIC.VERSION="2.2.0",e.STATIC.token=null,e.STATIC.trackingId=null,e.STATIC.active=!1,e.STATIC.displayProgress=!1,e.STATIC.slashesRegEx=/[^\/|\\\\]*$/,e.STATIC.fileExtensionRegEx=/(?:.*\.([^.]+))?$/,e.STATIC.FILE_UPLOAD_METHODS={XHR:"XHR",FORM:"FORM",WEBRTC:"WEBRTC"},e.CSS={},e.CSS.ID={DOWNLOADZONE_IDS:{AGAIN:"again",DL_BUTTON:"dl-button",DL_BUTTON_IMG:"dl-button-img",DL_BUTTON_INPUT:"dl-button-input",DL_FILENAME:"dl-filename",DL_FILENAME_TEXT:"dl-filename-text",DL_INFO:"dl-info",DL_STATUS:"dl-status",DOWNLOADZONE:"downloadzone"},DROPZONE_IDS:{DROPZONE:"dropzone",DROPZONE_HIGHLIGHT:"dropzone-highlight",DRAG_N_DROP:"drag-n-drop",DRAG_N_DROP_STATUS:"drag-n-drop-status",DND_SUPPORTED:"drag-n-drop-supported",DND_NOT_SUPPORTED:"drag-n-drop-not-supported",FILE_SELECT_DIV:"file-select-div",FILE_SELECT_INPUT:"file-select-input",FILE_SELECT_FORM:"file-select-form",FILE_SELECT_IFRAME:"file-select-iframe",PARACHUTE:"parachute"},ERRORZONE_IDS:{ERRORZONE:"errorzone"},FILEZONE_IDS:{FILEZONE:"filezone",FILES:"files",ZIPPED_MESSAGE:"zipped-message",CREATE_LINK_BUTTON:"create-link-button"},SHAREZONE_IDS:{SHAREZONE:"sharezone",SHARE_LINK_INPUT:"share-link-input",QR_CODE:"qr-code"},STATUSZONE_IDS:{STATUS:"status",STATUSZONE:"statuszone"}},e.CSS.CLASS={DROPZONE_CLASSES:{FILE_SELECT_DIV:"file-select-div",FILE_SELECT_INPUT:"file-select-input",FILE_SELECT_FORM:"file-select-form",PARACHUTE_HOVER:"parachute-hover",DRAG_N_DROP_HOVER:"drag-n-drop-hover"},ERRORZONE_CLASSES:{ERROR:"error",ERROR_TEXT:"error-text",ERROR_TEXT_WRAPPER:"error-text-wrapper"},FILEZONE_CLASSES:{FILE:"file",FILE_HOVER:"file-hover",FILE_ICON:"file-icon",FILE_INFO:"file-info",FILE_NAME:"file-name",FILE_NAME_TEXT:"file-name-text",FILE_SIZE:"file-size",FILE_SIZE_TEXT:"file-size-text",FILE_STATUS:"file-status",FILE_STATUS_TEXT:"file-status-text",FILE_REMOVE:"file-remove",FILE_REMOVE_TEXT:"file-remove-text",SPINNER_WRAPPER:"spinner-wrapper"},GENERAL_CLASSES:{TEXT:"text",WARN:"warn",ZONE:"zone",HIDDEN:"hidden",INVISIBLE:"invisible",CLEARFIX:"clearfix",SELECT_NONE:"select-none",SELECT_TEXT:"select-text",STATUS_TEXT:"status-text",IN_PROGRESS_SPINNER:"in-progress-spinner"}},e.STATIC.EXTENSIONS={"":"none",aac:"aac",aiff:"aiff",avi:"avi",bat:"bat",bmp:"bmp",cmd:"cmd",dll:"dll",dmg:"dmg",doc:"doc",docu:"docu",docx:"doc",gif:"gif",htm:"htm",inf:"inf",ini:"ini",jpg:"jpeg",jpeg:"jpeg",midi:"midi",mov:"mov",mp3:"mp3",mp4:"mp4",mpa:"mpa",mpg:"mpg",none:"none",ocx:"ocx",png:"png",ppt:"ppt",psd:"psd",psp:"psp",rar:"rar",rtf:"rtf",sitx:"sitx",sys:"sys",txt:"txt",wav:"wav",write:"write",xls:"xls",zip:"zip"},e.STATIC.ENDPOINTS={ROOT_URL:function(){return"/"},TOKEN_URL:function(){return SERVER_ROOT+"/token"},WAIT_URL:function(){return SERVER_ROOT+"/wait"},INFO_URL:function(){return SERVER_ROOT+"/info"},DOWNLOAD_URL:function(){return SERVER_ROOT+"/download"},UPLOAD_URL:function(){return SERVER_ROOT+"/upload"},STATUS_URL:function(){return SERVER_ROOT+"/status"}},e.STATIC.TRANSFER_STATE={NOT_STARTED:"NOT_STARTED",TOKEN_CREATED:"TOKEN_CREATED",UPLOADER_WAITING:"UPLOADER_WAITING",DOWNLOADER_WAITING:"DOWNLOADER_WAITING",IN_PROGRESS:"IN_PROGRESS",COMPLETED:"COMPLETED",FAILED:"FAILED"},e.STATIC.TRANSFER_ERROR={NONE:"NONE",TIMEOUT:"TIMEOUT",NO_PROGRESS:"NO_PROGRESS",UPLOADER_LEFT:"UPLOADER_LEFT",DUPLICATE_FILE_NAME:"DUPLICATE_FILE_NAME",FILE_TRANSFER_INTERRUPTED:"FILE_TRANSFER_INTERRUPTED",TRANSFER_CLOSED_BY_RECEIVER:"TRANSFER_CLOSED_BY_RECEIVER",TRANSFER_CLOSED_BY_SENDER:"TRANSFER_CLOSED_BY_SENDER",TRANSFER_INTERRUPTED:"TRANSFER_INTERRUPTED",CLEAN_UP:"CLEAN_UP",UNKNOWN:"UNKNOWN"},e.STATIC.TRACKING={},e.STATIC.TRACKING.EVENTS={LINK_GENERATED:"LINK_GENERATED",LINK_VISITED:"LINK_VISITED",TRANSFER_STARTED:"TRANSFER_STARTED",TRANSFER_FINISHED:"TRANSFER_FINISHED",EXPIRED_TOKEN:"EXPIRED_TOKEN",INVALID_TOKEN:"INVALID_TOKEN",FILE:"FILE"},e.STATIC.TRACKING.TRANSFER_STATUS={SUCCESS:"SUCCESS",TIMEOUT:"TIMEOUT",NO_PROGRESS:"NO_PROGRESS",UPLOADER_LEFT:"UPLOADER_LEFT",DUPLICATE_FILE_NAME:"DUPLICATE_FILE",FILE_TRANSFER_INTERRUPTED:"INTERRUPTED",TRANSFER_CLOSED_BY_RECEIVER:"TRANSFER_CLOSED_BY_RECEIVER",TRANSFER_CLOSED_BY_SENDER:"TRANSFER_CLOSED_BY_SENDER",TRANSFER_INTERRUPTED:"TRANSFER_INTERRUPTED",CLEAN_UP:"CLEAN_UP",UNKNOWN:"UNKNOWN"},e.STATIC.MESSAGES={READY:"READY",TIMEOUT:"TIMEOUT",WAITING:"WAITING...",PENDING:"PENDING... ",SELECT_FILES_TO_BEAM:"select file(s) to beam",SOMETHING_WENT_WRONG:"Something went wrong. Please refresh the page and try again.",DND_SUPPORTED:'<div id="'+e.CSS.ID.DROPZONE_IDS.DND_SUPPORTED+'"><span class="text">drag \'n drop your file(s) to transfer anywhere on the page</span><br/><div><span class="text">if you prefer the old fashioned way, click on the parachute to select your file(s)</span></div></div>',DND_NOT_SUPPORTED:'<div id="'+e.CSS.ID.DROPZONE_IDS.DND_NOT_SUPPORTED+"\"><span>please select your file(s) to beam</span><br/><div><span>drag n' drop is not supported by this browser</span></div></div>",BROWSER_NOT_SUPPORTED:'<p class="'+e.CSS.CLASS.FILEZONE_CLASSES.WARN+'">Your browser is currently unsupported.<br/><a href="/help">More Information</a></p>',DL_FAILED:"your download failed :(",DL_COMPLETED:"your download is done :)",DL_STARTING:"your download is starting...",DL_PROGRESS:"your download is in progress...",DL_INTERRUPTED:"your download was interrupted and failed :(",EXPIRED_LINK:"sorry, this download link has expired :(",INVALID_LINK:"sorry, this download link no longer exists :(",TRANSFER_IN_PROGRESS:"Transfer In-Progress...",WINDOW_CLOSE_WARNING:"Closing this window will cancel your transfer"},e.STATIC.URL_PARAMS={TRANSFER_FAILURE:"failure",FILE_COUNT:"fc",TRACKING_ID:"trk"},e.UTILS={},e.UTILS.attachEvent=function(b,c,d){b.attachEvent?(b["e"+c+d]=d,b[c+d]=function(){b["e"+c+d](a.event)},b.attachEvent("on"+c,b[c+d])):b.addEventListener(c,d,!1)},e.UTILS.detachEvent=function(a,b,c){a.detachEvent?(a.detachEvent("on"+b,a[b+c]),a[b+c]=null):a.removeEventListener(b,c,!1)},e.UTILS.createDomElement=function(a,c,d){var e=b.createElement("div");e.innerHTML=a;for(var f=b.createDocumentFragment();e.childNodes[0];)f.appendChild(e.childNodes[0]);var g=f.childNodes[0];return"prepend"===d?c.insertBefore(f,c.firstChild):c.appendChild(f),g},e.UTILS.isStringEmpty=function(a){return!a||0===a.length},e.UTILS.isStringBlank=function(a){return!a||/^\s*$/.test(a)},e.UTILS.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},e.UTILS.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},e.UTILS.isDragDropSupported=function(){return Modernizr.draganddrop&&e.UTILS.isXhrUploadSupported()},e.UTILS.isInputAttributeSupported=function(a){return Modernizr.input[a]?!0:!1},e.UTILS.isXhrUploadSupported=function(){return"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof(new XMLHttpRequest).upload},e.UTILS.getUrlParamByName=function(b){var c=RegExp("[?&]"+b+"=([^&]*)").exec(a.location.search);return c&&decodeURIComponent(c[1].replace(/\+/g," "))},e.UTILS.hasUrlParam=function(b){var c=RegExp("[?&]"+b+"=([^&]*)").exec(a.location.search);return null!==c},e.UTILS.randomStr=function(a,b){var c="";b.indexOf("a")>-1&&(c+="abcdefghijklmnopqrstuvwxyz"),b.indexOf("A")>-1&&(c+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),b.indexOf("#")>-1&&(c+="0123456789"),b.indexOf("!")>-1&&(c+="~`!@#$%^&*()_+-={}[]:\";'<>?,./|\\");for(var d="",e=0;a>e;e++)d+=c[Math.round(Math.random()*(c.length-1))];return d},e.UTILS.getReadableFileSizeString=function(a,b){var c=-1,d=b?[" kB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"]:[" KiB"," MiB"," GiB"," TiB"," PiB"," EiB"," ZiB"," YiB"],e=b?1e3:1024;do a/=e,c++;while(a>=e);return Math.max(a,.1).toFixed(2)+d[c]},e.UTILS.getTransferDownloadName=function(a){return a.length>1?"jbi-"+e.STATIC.token+".zip":a[0].fileName},e.UTILS.handleFileName=function(a){if(e.UTILS.isStringEmpty(a))return"";a=e.STATIC.slashesRegEx.exec(a)[0];var b="",c="",d=e.STATIC.fileExtensionRegEx.exec(a);d[1]?(b=d[1].toLowerCase(),c=d[0].length>=36+b.length?d[0].substr(0,32)+"... ."+b:a):c=a.length>=36?filename.substr(0,32)+"... ":a;var f=[];return f.push(c),f.push(b),f},e.UTILS.getFileExtension=function(a){if(e.UTILS.isStringEmpty(a))return"";var b="",c=e.STATIC.fileExtensionRegEx.exec(a);return c[1]&&(b=c[1].toLowerCase()),b},e.UTILS.UniqueIdGenerator=function(a,b){var c=0,d=a,e=b;return{generateID:function(){return d+c++ +e},generateIdAsArray:function(){return[d,c++,e]}}};var f=5e3,g=1.25;return e.UTILS.statusPoll=function(a,b){b=b&&f>b?b:f;var d=c.ajax({type:"GET",dataType:"JSON",data:{token:e.STATIC.token,breakcache:Math.random()},url:e.STATIC.ENDPOINTS.STATUS_URL()});d.error(function(b){a(b)}),d.success(function(c){if(!c.validToken)return void a(c);var d=c.transferState;d===e.STATIC.TRANSFER_STATE.UPLOADER_WAITING||d===e.STATIC.TRANSFER_STATE.DOWNLOADER_WAITING?setTimeout(function(){e.UTILS.statusPoll(a,b)},b):d===e.STATIC.TRANSFER_STATE.IN_PROGRESS?(a(c),setTimeout(function(){e.UTILS.statusPoll(a,b*g)},b)):(d===e.STATIC.TRANSFER_STATE.COMPLETED||d===e.STATIC.TRANSFER_STATE.FAILED)&&a(c)})},e.UTILS.generateTokenDownloadUrl=function(){var b=a.location.protocol,c=a.location.hostname,d=a.location.port?":"+a.location.port:"";return b+"//"+c+d+e.STATIC.ENDPOINTS.DOWNLOAD_URL()+e.STATIC.token},e.UTILS.generateTokenShareUrl=function(){var b=a.location.protocol,c=a.location.hostname,d=a.location.port?":"+a.location.port:"";return b+"//"+c+d+e.STATIC.ENDPOINTS.ROOT_URL()+e.STATIC.token},e.UTILS.generateTokenUploadUrl=function(a,b){var c=e.STATIC.ENDPOINTS.UPLOAD_URL();return c+="?",c+="type="+a+"&",c+="token="+e.STATIC.token+"&",c+="index="+b},e.UTILS.trackEventLinkGenerated=function(a){if(e.STATIC.trackingId){var b={client:e.STATIC.CLIENT,version:e.STATIC.VERSION,fileCount:a};amplitude.getInstance().setUserId(e.STATIC.trackingId),amplitude.getInstance().logEvent(e.STATIC.TRACKING.EVENTS.LINK_GENERATED,b)}},e.UTILS.trackEventLinkVisited=function(a){if(e.STATIC.trackingId){var b={client:e.STATIC.CLIENT,version:e.STATIC.VERSION,fileCount:a};amplitude.getInstance().setUserId(e.STATIC.trackingId),amplitude.getInstance().logEvent(e.STATIC.TRACKING.EVENTS.LINK_VISITED,b)}},e.UTILS.trackEventTransferStarted=function(a,b,c,d,f){if(e.STATIC.trackingId){var g={client:e.STATIC.CLIENT,version:e.STATIC.VERSION,uploadMethod:a,totalSize:b,fileCount:c,fileSizes:d,fileExtensions:f};amplitude.getInstance().setUserId(e.STATIC.trackingId),amplitude.getInstance().logEvent(e.STATIC.TRACKING.EVENTS.TRANSFER_STARTED,g)}},e.UTILS.trackEventTransferFinished=function(a,b,c){if(e.STATIC.trackingId){var d={client:e.STATIC.CLIENT,version:e.STATIC.VERSION,status:a,totalSize:c,fileCount:b};amplitude.getInstance().setUserId(e.STATIC.trackingId),amplitude.getInstance().logEvent(e.STATIC.TRACKING.EVENTS.TRANSFER_FINISHED,d)}},e.UTILS.trackEventInvalidToken=function(){if(e.STATIC.trackingId){var a={client:e.STATIC.CLIENT,version:e.STATIC.VERSION};amplitude.getInstance().setUserId(e.STATIC.trackingId),amplitude.getInstance().logEvent(e.STATIC.TRACKING.EVENTS.INVALID_TOKEN,a)}},e.UTILS.trackEventExpiredToken=function(a,b){if(e.STATIC.trackingId){var c={client:e.STATIC.CLIENT,version:e.STATIC.VERSION,status:e.STATIC.TRACKING.TRANSFER_STATUS.TIMEOUT,fileCount:b};amplitude.getInstance().setUserId(e.STATIC.trackingId),amplitude.getInstance().logEvent(e.STATIC.TRACKING.EVENTS.EXPIRED_TOKEN,c)}},e.UTILS.trackEventFile=function(a,b){if(!(0>b||b>=a.length)){var c={client:e.STATIC.CLIENT,version:e.STATIC.VERSION,fileSize:a[b].getFileSize(),fileExtension:e.UTILS.getFileExtension(a[b].getFileName())};amplitude.getInstance().setUserId(e.STATIC.trackingId),amplitude.getInstance().logEvent(e.STATIC.TRACKING.EVENTS.FILE,c)}},e}(window,document,jQuery);c.UploadPage=function(a,b,d,e){function f(){i=new c.FileHandler,j=new c.UploadHandler(i),k=new c.BrowserDetectUtility,g();var d=b.getElementById(c.CSS.ID.FILEZONE_IDS.CREATE_LINK_BUTTON);c.UTILS.attachEvent(d,"click",function(a){(!c.STATIC.active||confirm("Your transfer is already active. Do you want to terminate it and start a new one?"))&&(c.STATIC.active=!0,j.cancel(),j.transfer())}),a.onbeforeunload=function(){return c.STATIC.active?c.STATIC.MESSAGES.WINDOW_CLOSE_WARNING:void 0}}function g(){c.UTILS.isDragDropSupported()?(d("#"+c.CSS.ID.DROPZONE_IDS.DRAG_N_DROP_STATUS).html(c.STATIC.MESSAGES.DND_SUPPORTED),h()):d("#"+c.CSS.ID.DROPZONE_IDS.DRAG_N_DROP_STATUS).html(c.STATIC.MESSAGES.DND_NOT_SUPPORTED),d("#"+c.CSS.ID.DROPZONE_IDS.PARACHUTE).hover(function(){d(this).addClass(c.CSS.CLASS.DROPZONE_CLASSES.PARACHUTE_HOVER)},function(){d(this).removeClass(c.CSS.CLASS.DROPZONE_CLASSES.PARACHUTE_HOVER)})}function h(){var a=d();d.fn.dndhover=function(b){return this.each(function(){var b=d(this),c="dndHoverEnd",e="dndHoverStart";b.on("dragenter",function(c){0===a.size()&&b.trigger(e),a=a.add(c.target)}),b.on("dragleave",function(d){setTimeout(function(){a=a.not(d.target),0===a.size()&&b.trigger(c)},1)}),b.on("dragover",function(a){return a.stopPropagation(),a.preventDefault(),!1})})},d(b.body).dndhover().on({dndHoverStart:function(a){return c.STATIC.active===!1&&d("#"+c.CSS.ID.DROPZONE_IDS.DRAG_N_DROP).show(),a.stopPropagation(),a.preventDefault(),!1},dndHoverEnd:function(a){return c.STATIC.active===!1&&d("#"+c.CSS.ID.DROPZONE_IDS.DRAG_N_DROP).hide(),a.stopPropagation(),a.preventDefault(),!1}}),d(b.body).on("drop",function(b){if(a=d(),d("#"+c.CSS.ID.DROPZONE_IDS.DRAG_N_DROP).hide(),c.STATIC.active===!1){var e=b.originalEvent.dataTransfer.files;e.length>0&&i.handleFileList(e)}return b.stopPropagation(),b.preventDefault(),!1})}var i=null,j=null,k=null;return{initialize:f,buildFileSelectButton:function(){j.resetFileSelectButton()},getFileHandler:function(){return i}}}(window,document,jQuery),$(document).ready(function(){c.UploadPage.initialize()}),c.UploadHandler=function(a){function b(){var a=$.ajax({type:"POST",dataType:"JSON",data:{files:i.getFilesJSON(),breakcache:Math.random()},url:c.STATIC.ENDPOINTS.TOKEN_URL()});a.success(function(a){d(a)}),a.error(function(a,b,d){console.error("requestTransferToken(): AJAX error"),console.error(d),$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_REMOVE).remove(),$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT).html(c.STATIC.TRANSFER_STATE.FAILED)})}function d(a){return a.token?(c.STATIC.token=a.token,c.STATIC.trackingId=a.trackingId,c.UTILS.trackEventLinkGenerated(i.getCount()),i.updateFileIdentifiers(),e(),void f()):(console.error("handleTokenResponse(): token is invalid"),$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_REMOVE).remove(),void $("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT).html(c.STATIC.TRANSFER_STATE.FAILED))}function e(){$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_REMOVE).remove(),$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT).html(c.STATIC.MESSAGES.WAITING);var a=c.UTILS.generateTokenShareUrl();$("#"+c.CSS.ID.SHAREZONE_IDS.SHARE_LINK_INPUT).attr("value",a);var b=128,d="https://chart.googleapis.com/chart?cht=qr&chs="+b+"x"+b+"&choe=UTF-8&chld=H|0&chl="+encodeURIComponent(a);$("#"+c.CSS.ID.SHAREZONE_IDS.QR_CODE).attr("src",d).click(function(){var a=parseInt($("#"+c.CSS.ID.SHAREZONE_IDS.SHAREZONE).css("padding-bottom"),10);100>a?$("#"+c.CSS.ID.SHAREZONE_IDS.SHAREZONE).animate({"padding-bottom":"164px"},"fast"):$("#"+c.CSS.ID.SHAREZONE_IDS.SHAREZONE).animate({"padding-bottom":"54px"},"fast")}),$("."+c.CSS.CLASS.GENERAL_CLASSES.ZONE).not("#"+c.CSS.ID.FILEZONE_IDS.FILEZONE).addClass(c.CSS.CLASS.GENERAL_CLASSES.HIDDEN),$("#"+c.CSS.ID.SHAREZONE_IDS.SHAREZONE).removeClass(c.CSS.CLASS.GENERAL_CLASSES.HIDDEN)}function f(){var a=$.ajax({type:"GET",dataType:"JSON",data:{token:c.STATIC.token},url:c.STATIC.ENDPOINTS.WAIT_URL()});l=a,a.success(function(a){a.validToken?a.transferState===c.STATIC.TRANSFER_STATE.FAILED&&a.errorReason===c.STATIC.TRANSFER_ERROR.TIMEOUT?(c.UTILS.trackEventTransferFinished(c.STATIC.TRACKING.TRANSFER_STATUS.TIMEOUT,i.getCount(),i.getSize()),c.STATIC.active=!1,$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT).html(c.STATIC.MESSAGES.TIMEOUT)):a.transferState===c.STATIC.TRANSFER_STATE.DOWNLOADER_WAITING&&a.errorReason===c.STATIC.TRANSFER_ERROR.NONE&&(g(),$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT).html(c.STATIC.MESSAGES.READY),k.upload(i)):(console.error("waitForConnection(): invalid token"),c.STATIC.active=!1,$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT).html(c.STATIC.TRANSFER_STATE.FAILED))}),a.error(function(){})}function g(){for(var a=i.getFiles(),b=[],d=[],e=0,f=a.length;f>e;e++)b.push(a[e].getFileSize()),d.push(c.UTILS.getFileExtension(a[e].getFileName()));c.UTILS.trackEventTransferStarted(j,i.getSize(),i.getCount(),b,d)}function h(){l&&l.abort()}var i=a,j=c.UTILS.isXhrUploadSupported()?c.STATIC.FILE_UPLOAD_METHODS.XHR:c.STATIC.FILE_UPLOAD_METHODS.FORM,k=new c.UploadHandler[j],l=null,m=function(){function a(){j===c.STATIC.FILE_UPLOAD_METHODS.FORM&&(e(),f()),b(),d()}function b(){$("#"+c.CSS.ID.DROPZONE_IDS.FILE_SELECT_DIV).removeAttr("id");var a="<div></div>",b=document.getElementById(n),d=c.UTILS.createDomElement(a,b);d.setAttribute("id",c.CSS.ID.DROPZONE_IDS.FILE_SELECT_DIV),d.setAttribute("class",c.CSS.CLASS.DROPZONE_CLASSES.FILE_SELECT_DIV),l=d}function d(){$("#"+c.CSS.ID.DROPZONE_IDS.FILE_SELECT_INPUT).addClass(c.CSS.CLASS.GENERAL_CLASSES.HIDDEN).removeAttr("id");var a='<input type="file" />',f=l,h=c.UTILS.createDomElement(a,f,"prepend");h.setAttribute("id",c.CSS.ID.DROPZONE_IDS.FILE_SELECT_INPUT),h.setAttribute("class",c.CSS.CLASS.DROPZONE_CLASSES.FILE_SELECT_INPUT),h.setAttribute("title",c.STATIC.MESSAGES.SELECT_FILES_TO_BEAM),h.setAttribute("name",""),o===!0&&j===c.STATIC.FILE_UPLOAD_METHODS.XHR&&h.setAttribute("multiple","multiple"),c.UTILS.attachEvent(h,"change",function(){h.files&&0===h.files.length||(i.handleInputElement(h,g,j),j===c.STATIC.FILE_UPLOAD_METHODS.FORM&&(e(),b(),d()))}),m=h}function e(){$("#"+c.CSS.ID.DROPZONE_IDS.FILE_SELECT_FORM).removeAttr("id");var a='<form enctype="multipart/form-data"></form>',b=document.getElementById(c.CSS.ID.DROPZONE_IDS.PARACHUTE),d=c.UTILS.createDomElement(a,b,"prepend");d.setAttribute("id",c.CSS.ID.DROPZONE_IDS.FILE_SELECT_FORM),d.setAttribute("class",c.CSS.CLASS.DROPZONE_CLASSES.FILE_SELECT_FORM),d.setAttribute("target",c.CSS.ID.DROPZONE_IDS.FILE_SELECT_IFRAME),d.setAttribute("method","POST"),d.setAttribute("action","invalid"),g=d}function f(){var a=document.createElement("iframe");a.id=c.CSS.ID.DROPZONE_IDS.FILE_SELECT_IFRAME,a.name=c.CSS.ID.DROPZONE_IDS.FILE_SELECT_IFRAME,a.src="javascript:false;",a.style.display="none",$(a).bind("load",function(){$(a).unbind("load").bind("load",function(){try{var b=$(a).contents().find("body").html();if(response=$.parseJSON(b),!response)return;response.validToken&&response.transferState!==c.STATIC.TRANSFER_STATE.FAILED?k.upload(i):c.UTILS.trackEventTransferFinished(c.STATIC.TRACKING.TRANSFER_STATUS[response.errorReason],i.getCount(),i.getSize())}catch(d){}})}),h=a,$(g).after(h)}var g=null,h=null,l=null,m=null,n=k.getFileSelectButtonParentId(),o=c.UTILS.isInputAttributeSupported("multiple")?!0:!1;return{initialize:a,reset:function(){$("#"+c.CSS.ID.DROPZONE_IDS.PARACHUTE).empty(),a()}}},n=new m;return n.initialize(),{getHandlerType:function(){return j},resetFileSelectButton:function(){n.reset()},transfer:function(){b()},cancel:function(){h()}}},c.UploadHandler.FORM=function(){function a(){h=0,c.STATIC.active=!1}function b(b){var e=b.getFiles(),f=b.getForms();if(e.length!==f.length)return void a();if(c.UTILS.trackEventFile(e,h-1),e.length===h+1&&c.UTILS.trackEventTransferFinished(c.STATIC.TRACKING.TRANSFER_STATUS.SUCCESS,b.getCount(),b.getSize()),h>=e.length)return void a();var g=f[h],i=e[h].getId();g.setAttribute("action",c.UTILS.generateTokenUploadUrl(c.STATIC.FILE_UPLOAD_METHODS.FORM,i)),g.submit(),c.STATIC.displayProgress=!0,$($("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT)[h]).text(c.STATIC.MESSAGES.PENDING).removeClass(c.CSS.CLASS.GENERAL_CLASSES.INVISIBLE),function(a){d(a)}(h),h++}function d(a){c.UTILS.statusPoll(function(b){if(b.validToken&&b.transferState!==c.STATIC.TRANSFER_STATE.FAILED){if(b.transferState===c.STATIC.TRANSFER_STATE.COMPLETED)e(c.STATIC.TRANSFER_STATE.COMPLETED),g();else if(b.transferState===c.STATIC.TRANSFER_STATE.IN_PROGRESS){var d=b.files[a].state;if(d===c.STATIC.TRANSFER_STATE.COMPLETED)e(c.STATIC.TRANSFER_STATE.COMPLETED,a),g(a);else if(d===c.STATIC.TRANSFER_STATE.IN_PROGRESS){var h=Math.round(b.transferredBytes/b.transferSizeBytes*100);c.UTILS.isNumber(h)&&h>=0?(e(h+"%",a),g(a)):f(a)}else f(a)}}else e(c.STATIC.TRANSFER_STATE.FAILED),g()})}function e(a,b){var d;d=$("number"==typeof b&&b%1===0?$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT)[b]:"."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT),d.text(a)}function f(a){var b,d;"number"==typeof a&&a%1===0?(b=$($("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT)[a]),d=$($("."+c.CSS.CLASS.GENERAL_CLASSES.IN_PROGRESS_SPINNER)[a])):(b=$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT),d=$("."+c.CSS.CLASS.GENERAL_CLASSES.IN_PROGRESS_SPINNER)),b.addClass(c.CSS.CLASS.GENERAL_CLASSES.INVISIBLE),d.removeClass(c.CSS.CLASS.GENERAL_CLASSES.HIDDEN)}function g(a){var b,d;"number"==typeof a&&a%1===0?(b=$($("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT)[a]),d=$($("."+c.CSS.CLASS.GENERAL_CLASSES.IN_PROGRESS_SPINNER)[a])):(b=$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT),d=$("."+c.CSS.CLASS.GENERAL_CLASSES.IN_PROGRESS_SPINNER)),b.removeClass(c.CSS.CLASS.GENERAL_CLASSES.INVISIBLE),d.addClass(c.CSS.CLASS.GENERAL_CLASSES.HIDDEN)}var h=0;return{upload:b,getFileSelectButtonParentId:function(){return c.CSS.ID.DROPZONE_IDS.FILE_SELECT_FORM}}},c.UploadHandler.XHR=function(){function a(){c.STATIC.active=!1}function b(g,h){{var i=g.getFiles();g.getForms()}if(0>h||h>=i.length)return void a();var j=i[h].getFileObject(),k=new XMLHttpRequest;!function(h,j){h.onreadystatechange=function(){if(h.readyState===h.DONE&&200===h.status){var e=$.parseJSON(h.responseText),f=d(e,j);f?(c.UTILS.trackEventFile(i,j),i.length===j+1&&c.UTILS.trackEventTransferFinished(c.STATIC.TRACKING.TRANSFER_STATUS.SUCCESS,g.getCount(),g.getSize()),b(g,j+1)):(c.UTILS.trackEventTransferFinished(c.STATIC.TRACKING.TRANSFER_STATUS[e.errorReason],i.length),a(),$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT).text(c.STATIC.TRANSFER_STATE.FAILED))}};var k=h.upload;c.UTILS.attachEvent(k,"progress",function(a){e(a,j)}),c.UTILS.attachEvent(k,"error",function(a){f(c.STATIC.TRANSFER_STATE.FAILED)}),c.UTILS.attachEvent(k,"load",function(a){}),c.UTILS.attachEvent(k,"abort",function(a){})}(k,h);var l=i[h].getId();k.open("POST",c.UTILS.generateTokenUploadUrl(c.STATIC.FILE_UPLOAD_METHODS.XHR,l),!0);var m=new FormData;m.append(l,j),k.send(m)}function d(a,b){return a.validToken&&a.transferState!==c.STATIC.TRANSFER_STATE.FAILED?a.transferState===c.STATIC.TRANSFER_STATE.COMPLETED||a.transferState===c.STATIC.TRANSFER_STATE.IN_PROGRESS?(f(c.STATIC.TRANSFER_STATE.COMPLETED,b),!0):!1:(f(c.STATIC.TRANSFER_STATE.FAILED),!1)}function e(a,b){if(a.lengthComputable&&c.STATIC.displayProgress){var d=Math.round(100*a.loaded/a.total);this.currentProgress!=d&&(this.currentProgress=d),f(d+"%",b)}}function f(a,b){"number"==typeof b&&b%1===0?$($("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT)[b]).text(a):$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT).text(a)}return{upload:function(a){c.STATIC.displayProgress=!0,$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT).html(c.STATIC.MESSAGES.PENDING),b(a,0)},getFileSelectButtonParentId:function(){return c.CSS.ID.DROPZONE_IDS.PARACHUTE}}},c.FileHandler=function(){function a(a,e,f){var g=d([e],j);j=g,a.files?f===c.STATIC.FILE_UPLOAD_METHODS.FORM?b(a.files,a):b(a.files):b(null,a)}function b(a,b){for(var c=[],f=a&&a.length>0,g=f?a.length:1,j=0;g>j;j++)c.push(f?new h(l.generateID(),b,a[j]):new h(l.generateID(),b,null));var k=d(c,i);i=k,e(c)}function d(a,b){for(var c=[],d=a.length+b.length,e=0;d>e;e++)c.push(0);for(var e=0;e<a.length;e++)c[e]=a[e];for(var e=0;e<b.length;e++)c[a.length+e]=b[e];return c}function e(a){$("#"+c.CSS.ID.FILEZONE_IDS.FILES).removeClass(c.CSS.CLASS.GENERAL_CLASSES.HIDDEN).removeClass(c.CSS.CLASS.GENERAL_CLASSES.INVISIBLE);for(var b=a.length,d=b-1;d>=0;d--)if(!a[d].isFileVisible()){var e=a[d],h=e.getId(),i=e.getFileName(),j=e.getFileSize(),l=c.UTILS.handleFileName(i),m=l[0],n=l[1];e.setVisibility(!0);var o=c.STATIC.EXTENSIONS[n]?c.STATIC.EXTENSIONS[n]:c.STATIC.EXTENSIONS.none,p='<img src="/static/img/extensions/'+o+'.png" width="72" />',q='<div id="'+h+'" class="'+c.CSS.CLASS.FILEZONE_CLASSES.FILE+" "+c.CSS.CLASS.GENERAL_CLASSES.TEXT+'"><div class="file-border"><div class="'+c.CSS.CLASS.FILEZONE_CLASSES.FILE_ICON+'">'+p+'</div><div class="'+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS+'"><span class="'+c.CSS.CLASS.FILEZONE_CLASSES.FILE_STATUS_TEXT+'"></span></div><div class="'+c.CSS.CLASS.FILEZONE_CLASSES.SPINNER_WRAPPER+'"><img class="'+c.CSS.CLASS.GENERAL_CLASSES.HIDDEN+" "+c.CSS.CLASS.GENERAL_CLASSES.IN_PROGRESS_SPINNER+'" alt="'+c.STATIC.MESSAGES.TRANSFER_IN_PROGRESS+'" src="/static/img/in-progress.gif" /></div><div class="'+c.CSS.CLASS.FILEZONE_CLASSES.FILE_REMOVE+'"></div><div class="'+c.CSS.CLASS.FILEZONE_CLASSES.FILE_INFO+'"><div class="'+c.CSS.CLASS.FILEZONE_CLASSES.FILE_NAME+'"><span class="'+c.CSS.CLASS.FILEZONE_CLASSES.FILE_NAME_TEXT+'">'+m+'</span></div><div class="'+c.CSS.CLASS.FILEZONE_CLASSES.FILE_SIZE+'"><span class="'+c.CSS.CLASS.FILEZONE_CLASSES.FILE_SIZE_TEXT+'">'+c.UTILS.getReadableFileSizeString(j,!0)+"</span></div></div></div></div>",r=c.UTILS.createDomElement(q,k,"prepend");f(r),g(r,h),$("#"+c.CSS.ID.FILEZONE_IDS.ZIPPED_MESSAGE).removeClass(c.CSS.CLASS.GENERAL_CLASSES.HIDDEN),$("#"+c.CSS.ID.FILEZONE_IDS.FILES).removeClass(c.CSS.CLASS.GENERAL_CLASSES.HIDDEN),$("#"+c.CSS.ID.FILEZONE_IDS.FILEZONE).removeClass(c.CSS.CLASS.GENERAL_CLASSES.HIDDEN)}}function f(a){$(a).hover(function(){$(this).addClass(c.CSS.CLASS.FILEZONE_CLASSES.FILE_HOVER)},function(){$(this).removeClass(c.CSS.CLASS.FILEZONE_CLASSES.FILE_HOVER)})}function g(a,b){$(a).find("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE_REMOVE).click(function(){$(this).parents("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE).slideUp(250,function(){$(this).remove();for(var a=0;a<i.length;a++)if(i[a].getId()===b){$(j[a]).remove(),j.splice(a,1),i.splice(a,1);break}1==$("#"+c.CSS.ID.FILEZONE_IDS.FILES).children().size()&&($("#"+c.CSS.ID.FILEZONE_IDS.FILES).addClass("invisible"),c.UploadPage.buildFileSelectButton())})})}var h=function(a,b,c){var d=a,e=b,f=c,g=0,h="",i=!1;return c?(h=c.fileName?c.fileName:c.name,g=c.fileSize?c.fileSize:c.size):b&&(h=b.value),{_name:h,getId:function(){return d},setId:function(a){d=a,e&&(e.name=a)},getFileName:function(){return h},getFileSize:function(){return g},getFileInput:function(){return e},setFileInput:function(a){e=a},getFileObject:function(){return f},isFileVisible:function(){return i},setVisibility:function(a){i=a}}},i=[],j=[],k=document.getElementById(c.CSS.ID.FILEZONE_IDS.FILES),l=new c.UTILS.UniqueIdGenerator("file_","");return{handleFileList:b,handleInputElement:a,getFiles:function(){return i},getForms:function(){return j},getCount:function(){return i.length},getSize:function(){for(var a=0,b=0,c=i.length;c>b;b++)a+=i[b].getFileSize();return a},getFilesJSON:function(){for(var a=new Array(i.length),b=0,d=i.length;d>b;b++){var e={};e.fileName=i[b].getFileName(),e.fileSize=i[b].getFileSize();var f=c.UTILS.getFileExtension(e.fileName);e.fileExtensionType=c.STATIC.EXTENSIONS[f]?c.STATIC.EXTENSIONS[f]:"unknown",a[b]=e}return JSON.stringify(a)},updateFileIdentifiers:function(){var a=$("."+c.CSS.CLASS.FILEZONE_CLASSES.FILE);if(a.length===i.length)for(var b=0,d=i.length;d>b;b++){var e=b;i[b].setId(e),a[b].setAttribute("id",e)}}}},c.BrowserDetectUtility=function(){var a={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!=c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(-1!=b)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return a.init(),{isLessThanInternetExplorer10:function(){return"Explorer"===a.browser&&a.version<10},isInternetExplorer:function(){return"Explorer"===a.browser}}}}({},function(){return this}());